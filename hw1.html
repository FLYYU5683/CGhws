<!DOCTYPE html>
<html>
<style>
#info {
  position: absolute;
  top: 20px;
  width: 100%;

  text-align: center;
  color: #ffff00
}

body {
 overflow: hidden;
}
</style>
<body>


<audio id="soundtrack" autoplay loop style="display:none">
<source src="https://flyyu5683.github.io/CGhws/alarn.mp3"  type='audio/mp3'>
</audio>

<div id = "info"><br>
<button id = 'toggle' style = "width: 20%">Start</button>
<button id = 'turnways' style = "width: 20%">Smooth</button><br>
<button id = 'count10' style = "width: 100px">+10sec</button>
<button id = 'count' style = "width: 100px">+1sec</button>

</div>

<script src="https://threejs.org/build/three.min.js"></script>
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
<script>
//https://jyunming-chen.github.io/game3js/gameHWhelpers/sounds/KennyG.mp3
$("#turnways").click(function(){
	ways = !ways;
	if(ways)
		$("#turnways").text("Smooth");
	else
		$("#turnways").text("SixDegs");
	angle = 0;
})

$("#count10").click(function(){
	angle += 10*6/180*Math.PI;
})

$("#count").click(function(){
	angle += 6/180*Math.PI;
})

$("#toggle").mousedown(function(e) {
    if ( pressed[e.which] ) return;
    pressed[e.which] = e.timeStamp;
	time += clock.getDelta();
	

});
    
$("#toggle").mouseup(function(e) {

    if ( !pressed[e.which] ) return;
		var duration = ( e.timeStamp - pressed[e.which] ) / 1000;
    pressed[e.which] = 0;
	console.log(duration);
	
	start = true;
	turn = !turn;
	if( duration >= 2){
		soundTrack.pause()
			console.log("yes");
		start = false;
		$("#toggle").text("Start");
		angle = 0;
		turn = false;
	}
	else{
		if(turn)
			$("#toggle").text("Stop");
		else
			$("#toggle").text("Turn");
	}

	
});

var soundTrack;

var pressed = {};

var camera, scene, renderer;
var angle = 0;
var turn = false;
var ways = true;
var groups = [];
var debug = true;
var count = 0;
var key = true;
var TimeOut;
var start = false;
var time = 0;

init();
animate();

function init() {
	soundTrack = document.getElementById ('soundtrack');

	for(var k = 0; k< 2;k++)
		groups[k] = new THREE.Group();

  renderer = new THREE.WebGLRenderer({
    antialias: true
  });

	renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.setClearColor(0x888888);
	document.body.appendChild(renderer.domElement);
	window.addEventListener('resize', onWindowResize, false);
  
	scene = new THREE.Scene();
	camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 1, 10000);
	camera.position.z = 120;

	/////////////////////////////////////////////////////////

	var geometry = new THREE.CircleGeometry( 50, 64 );
	var material = new THREE.MeshBasicMaterial( { color: 0xffff00 } );
	var circle = new THREE.Mesh( geometry, material );
	scene.add( circle );
	geometry = new THREE.PlaneGeometry( 5, 40 );
	material = new THREE.MeshBasicMaterial( {color: 0xff0000, side: THREE.DoubleSide} );
	plane = new THREE.Mesh( geometry, material );
	plane.position.y = 20;
	
	const x = 0, y = 0;

	const heartShape = new THREE.Shape();
	
	heartShape.moveTo( x + 5, y + 5 );
	heartShape.bezierCurveTo( x + 5, y + 5, x + 4, y, x, y );
	heartShape.bezierCurveTo( x - 6, y, x - 6, y + 7,x - 6, y + 7 );
	heartShape.bezierCurveTo( x - 6, y + 11, x - 3, y + 15.4, x + 5, y + 19 );
	heartShape.bezierCurveTo( x + 12, y + 15.4, x + 16, y + 11, x + 16, y + 7 );
	heartShape.bezierCurveTo( x + 16, y + 7, x + 16, y, x + 10, y );
	heartShape.bezierCurveTo( x + 7, y, x + 5, y + 5, x + 5, y + 5 );

	geometry = new THREE.ShapeGeometry( heartShape );
	material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
	mesh = new THREE.Mesh( geometry, material ) ;
	mesh.position.x = -5;
	mesh.position.y = 30;

	groups[0].valueOf().add(plane,mesh);
	
	scene.add(groups[0]);
	
	clock = new THREE.Clock();
	
	clock.getDelta();
	setTimeout(turnSixDegs, 0);
  
}
	function turnSixDegs(){
		if(turn && angle > 2.7755575615628914e-17 && !ways)
			angle -= 6/180*Math.PI;
		setTimeout(turnSixDegs,1000);
	}
	function countPlus(){
		count++;
		TimeOut = setTimeout(countPlus,1000);
	}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {

	if(debug){
		soundTrack.pause();
		debug = false;
	}

	var dt = clock.getDelta();
	
	if(turn && ways && angle > 2.7755575615628914e-17)
		angle -= 2 * Math.PI * dt /60;
		
		
	if(angle <= 2.7755575615628914e-17 && start == true){
		if(key){
			soundTrack.play();
			setTimeout(countPlus,0);
		}
		key = false;
	}
	else{
		clearTimeout(TimeOut);
		key = true;
		count = 0;
	}
	if(count >= 10)
		soundTrack.pause();
	
	groups[0].valueOf().position.set(0.6*Math.sin(angle),0.6*Math.cos(angle),0);
	groups[0].valueOf().rotation.z = -angle;
	
	requestAnimationFrame(animate);
	render();
}

function render() {
  renderer.render(scene, camera);
}

</script>

<div id="info">THREE.JS 2D Template</div>
</body>
</html>